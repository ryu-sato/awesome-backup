name: Application test

on:
  push:
    branches-ignore: [stable]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Start all DBs and middle
      run: |
        docker-compose -f .devcontainer/docker-compose.yml build --build-arg USER_UID=$(id -u) --build-arg USER_GID=$(id -g)
        docker-compose -f .devcontainer/docker-compose.yml up -d
    - name: Run test
      run:
        docker-compose -f .devcontainer/docker-compose.yml exec -T -- node bash -c 'yarn install && yarn test'
    # [TODO] Coverage report
